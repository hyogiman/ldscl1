<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ê´€ë¦¬ì í˜ì´ì§€</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="css/style.css" />
  <style>
    .tabs { display: flex; gap: 8px; margin-bottom: 20px; }
    .tabs button { padding: 10px; border: none; background: #ddd; cursor: pointer; }
    .tabs button.active { background: var(--primary-color); color: white; }
    .tab-section { display: none; }
    .tab-section.active { display: block; }
    input[type="number"] { width: 80px; }
  </style>
</head>
<body>
  <h1>ğŸ§  ê´€ë¦¬ì í˜ì´ì§€</h1>

  <div class="tabs">
    <button onclick="showTab('controlTab', this)" class="active">ğŸ” ì œì–´</button>
    <button onclick="showTab('teamTab', this)">ğŸ‘¥ íŒ€ ê´€ë¦¬</button>
    <button onclick="showTab('userTab', this)">ğŸ‘¤ ì°¸ê°€ì ê´€ë¦¬</button>
    <button onclick="showTab('optionTab', this)">ğŸ¯ ì„ íƒì§€ ê´€ë¦¬</button>
  </div>

  <!-- ğŸ” ì œì–´ íƒ­ -->
  <section id="controlTab" class="tab-section active">
    <h2>ğŸ” ë¼ìš´ë“œ ì œì–´</h2>
    <table>
      <tr><th>ë‹¨ê³„</th><th>ìƒíƒœ</th><th>ì œì–´</th></tr>
      <tr>
        <td>ë¡œê·¸ì¸</td>
        <td id="login_lock_status">-</td>
        <td>
          <button onclick="setControl('login_lock', true)">ğŸ”’</button>
          <button onclick="setControl('login_lock', false)">ğŸ”“</button>
        </td>
      </tr>
      <tr>
        <td>ì„¤ëª…</td>
        <td id="explain_lock_status">-</td>
        <td>
          <button onclick="setControl('explain_lock', true)">ğŸ”’</button>
          <button onclick="setControl('explain_lock', false)">ğŸ”“</button>
        </td>
      </tr>
      <tr>
        <td>ì„ íƒ</td>
        <td id="select_lock_status">-</td>
        <td>
          <button onclick="setControl('select_lock', true)">ğŸ”’</button>
          <button onclick="setControl('select_lock', false)">ğŸ”“</button>
        </td>
      </tr>
      <tr>
        <td>ê²°ê³¼</td>
        <td id="result_lock_status">-</td>
        <td>
          <button onclick="setControl('result_lock', true)">ğŸ”’</button>
          <button onclick="setControl('result_lock', false)">ğŸ”“</button>
        </td>
      </tr>
    </table>
  </section>

  <!-- ğŸ‘¥ íŒ€ ê´€ë¦¬ -->
  <section id="teamTab" class="tab-section">
    <h2>ğŸ‘¥ íŒ€ ê´€ë¦¬</h2>
    <input id="teamNameInput" placeholder="íŒ€ ì´ë¦„" />
    <button onclick="addTeam()">ì¶”ê°€</button>
    <table><thead><tr><th>íŒ€ëª…</th><th>ìˆ˜ì •</th><th>ì‚­ì œ</th></tr></thead>
      <tbody id="teamTableBody"></tbody>
    </table>
  </section>

  <!-- ğŸ‘¤ ì°¸ê°€ì ê´€ë¦¬ -->
  <section id="userTab" class="tab-section">
    <h2>ğŸ‘¤ ì°¸ê°€ì ë“±ë¡</h2>
    <select id="teamSelect"></select><br/>
    <input id="employeeNoInput" placeholder="ì‚¬ë²ˆ" />
    <input id="nameInput" placeholder="ì´ë¦„" />
    <button onclick="addUser()">ë“±ë¡</button>
    <table><thead><tr><th>ì´ë¦„</th><th>ì‚¬ë²ˆ</th><th>ì‚­ì œ</th></tr></thead>
      <tbody id="userTableBody"></tbody>
    </table>
  </section>

  <!-- ğŸ¯ ì„ íƒì§€ ê´€ë¦¬ -->
  <section id="optionTab" class="tab-section">
    <h2>ğŸ¯ ì„ íƒì§€ ì„¤ì •</h2>
    <select id="roundSelect" onchange="loadOptions()">
      <option value="round1">Round 1</option>
      <option value="round2">Round 2</option>
      <option value="round3">Round 3</option>
      <option value="round4">Round 4</option>
    </select>
    <table>
      <thead><tr><th>ì„ íƒì§€</th><th>ë¦¬ë”ì‹­ì ìˆ˜</th><th>ì—ë„ˆì§€ì ìˆ˜</th><th>ì €ì¥</th></tr></thead>
      <tbody id="optionTableBody"></tbody>
    </table>
  </section>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore-compat.js"></script>
  <script>
    const config = {
      apiKey: "AIzaSyBhI_N0bPlhaBaNXiyIHHWX5KzIznPD9fs",
      authDomain: "leadershipg-v1.firebaseapp.com",
      projectId: "leadershipg-v1"
    };
    firebase.initializeApp(config);
    const db = firebase.firestore();
    const controlRef = db.collection("round_status").doc("control");

    function showTab(id, btn) {
      document.querySelectorAll(".tab-section").forEach(s => s.classList.remove("active"));
      document.querySelectorAll(".tabs button").forEach(b => b.classList.remove("active"));
      document.getElementById(id).classList.add("active");
      btn.classList.add("active");
    }

    function setControl(key, val) {
      const update = {}; update[key] = val;
      controlRef.set(update, { merge: true });
    }

    controlRef.onSnapshot(doc => {
      const data = doc.data() || {};
      ["login_lock", "explain_lock", "select_lock", "result_lock"].forEach(k => {
        document.getElementById(k + "_status").innerText = data[k] ? "ğŸ”’" : "ğŸ”“";
      });
    });

    function addTeam() {
      const name = document.getElementById("teamNameInput").value.trim();
      if (!name) return;
      db.collection("teams").add({ name }).then(loadTeams);
      document.getElementById("teamNameInput").value = "";
    }

    async function loadTeams() {
      const tbody = document.getElementById("teamTableBody");
      const select = document.getElementById("teamSelect");
      tbody.innerHTML = "";
      select.innerHTML = "<option value=''>-- ì„ íƒ --</option>";
      const snap = await db.collection("teams").get();
      snap.forEach(doc => {
        const team = doc.data();
        tbody.innerHTML += `
          <tr>
            <td><input id="t_${doc.id}" value="${team.name}" /></td>
            <td><button onclick="updateTeam('${doc.id}')">ìˆ˜ì •</button></td>
            <td><button onclick="deleteTeam('${doc.id}')">ì‚­ì œ</button></td>
          </tr>`;
        select.innerHTML += `<option value="${doc.id}">${team.name}</option>`;
      });
    }

    function updateTeam(id) {
      const name = document.getElementById("t_" + id).value.trim();
      db.collection("teams").doc(id).update({ name }).then(() => alert("ìˆ˜ì •ë¨"));
    }

    function deleteTeam(id) {
      db.collection("teams").doc(id).delete().then(loadTeams);
    }

    function addUser() {
      const teamId = document.getElementById("teamSelect").value;
      const empNo = document.getElementById("employeeNoInput").value.trim();
      const name = document.getElementById("nameInput").value.trim();
      if (!teamId || !empNo || !name) return;
      db.collection("users").add({
        team_id: teamId, employee_no: empNo, name,
        energy: 5, leadership_score: 0
      }).then(() => {
        document.getElementById("employeeNoInput").value = "";
        document.getElementById("nameInput").value = "";
        loadUsers(teamId);
      });
    }

    function loadUsers(teamId) {
      const tbody = document.getElementById("userTableBody");
      tbody.innerHTML = "";
      db.collection("users").where("team_id", "==", teamId).get().then(snap => {
        snap.forEach(doc => {
          const u = doc.data();
          tbody.innerHTML += `<tr>
            <td>${u.name}</td><td>${u.employee_no}</td>
            <td><button onclick="deleteUser('${doc.id}', '${teamId}')">ì‚­ì œ</button></td></tr>`;
        });
      });
    }

    function deleteUser(id, teamId) {
      db.collection("users").doc(id).delete().then(() => loadUsers(teamId));
    }

    document.getElementById("teamSelect").addEventListener("change", e => {
      const teamId = e.target.value;
      if (teamId) loadUsers(teamId);
    });

    function loadOptions() {
      const round = document.getElementById("roundSelect").value;
      const tbody = document.getElementById("optionTableBody");
      tbody.innerHTML = "";
      db.collection("rounds").doc(round).get().then(doc => {
        const opts = doc.data()?.options || {};
        ["A", "B", "C", "D"].forEach(key => {
          const opt = opts[key] || { leadership: 0, energy: 0 };
          tbody.innerHTML += `
            <tr>
              <td>${key}</td>
              <td><input type="number" id="${key}_l" value="${opt.leadership}" /></td>
              <td><input type="number" id="${key}_e" value="${opt.energy}" /></td>
              <td><button onclick="saveOption('${round}', '${key}')">ì €ì¥</button></td>
            </tr>`;
        });
      });
    }

    function saveOption(round, key) {
      const l = parseInt(document.getElementById(key + "_l").value);
      const e = parseInt(document.getElementById(key + "_e").value);
      db.collection("rounds").doc(round).set({
        options: { [key]: { leadership: l, energy: e } }
      }, { merge: true }).then(() => alert(`${key} ì €ì¥ë¨`));
    }

    loadTeams();
    loadOptions();
  </script>
</body>
</html>
